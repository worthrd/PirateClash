<!DOCTYPE html> 
<html>
	<head>
	
			<title>Pirate Clash</title>
			<script src="d3.js" charset="utf-8"></script>
			<script src="jquery-2.1.4.min.js" charset="utf-8"></script>
			<script src="keybinding.js" charset="utf-8"></script>
			<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<svg swidth="1080px" height="768px"  style="height: 100%;width: 100%" >
			<defs>
			   <g id="ship">

			   		<!-- ship deck-->
				    <path d="M0,0 L10,20 L80,20 L90,0 L0,0" style="fill:none;stroke:black; stroke-width: 3px"/>
				    <path d="M45,0 L45, -70" style="fill:none;stroke:black; stroke-width: 2px"/>


			   </g>
			</defs>
		</svg>
		
		<script type="text/javascript">
            var ship;

			var socketio = io.connect("127.0.0.1:3000");

			socketio.on("moveResponse", function(data) {
				var direct = data['direction'];
                var x = d3.select(ship).node().attr("x");
                var y = d3.select(ship).node().attr("y");
               
				switch(direct){
					case "left":
					  d3.select(ship).node().transition().duration(500).ease("linear").attr("x", (parseInt(x)-10));
					break;
					case "up":
					  d3.select(ship).node().transition().duration(500).ease("linear").attr("y", (parseInt(y)-10));
					break;
					case "right":
					  d3.select(ship).node().transition().duration(500).ease("linear").attr("x", (parseInt(x)+10));
					break;
					case "down":
					  d3.select(ship).node().transition().duration(500).ease("linear").attr("y", (parseInt(y)+10));
					break;
					default:
					 break;
				}

				console.log("current x:" +x);
                console.log("current y:" +y);
			});


		   function move(direct) {
		   	  return function(event) {
			        event.preventDefault();
				    socketio.emit("moveRequest", { direction : direct});
			    };
		   	    
		   }

		   ship = d3.select('body').select('svg').append("use").attr("x", 50).attr("y", 250).attr("xlink:href", "#ship");

           d3.select('body').call(d3.keybinding()
		    .on('←', move("left"))
		    .on('↑', move("up"))
		    .on('→', move("right"))
		    .on('↓', move("down")));
           
           /*
		   (function repeat() {
		   	        if (x>300) 
		   	        {

		   	        	x = 50;	
		   	        }else{
		   	        	x=x+10;
		   	        }
                    d3.select(ship).node()
                 .transition().duration(500).ease("linear")
                   .attr("x", x)
                   .each("end", repeat);
            	})();

			*/

		</script>

	</body>
</html>

